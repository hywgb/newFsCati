# 测试计划（test-plan.md）

## 1. 范围
- 覆盖 CATI 全链路：外呼→早期媒体识别→坐席执行→录音质检→报表→合规

## 2. 测试类型
### 2.1 单元测试
- 问卷逻辑：分支/随机化/管道/必答
- 抽样与配额：优先级/锁/时间窗
- ESL 命令生成与解析：originate/uuid_* 指令
- ASR 文本分类规则：短语匹配、置信度聚合、阈值

### 2.2 集成测试
- FS 事件链：progress-media→audio_fork→ASR→决策→uuid_kill
- 录音归档一致性：文件命名/元数据/落库
- 预测拨号：CPS/并发控制、失败回拨策略

### 2.3 性能与容量
- 媒体并发：200/500/1000 路；CPU/RAM 水位
- ASR 延迟：P50/P90/P99；命中率 vs. 时延曲线
- Dialer 稳定性：Drop Rate 约束达标，抖动下恢复

### 2.4 端到端
- Campaign 全生命周期：建盘→导入→拨号→回拨→配额完成→导出
- 坐席体验：键盘操作、断网重连、断点续填
- 管理报表：实时看板一致性与时效性

### 2.5 安全与合规
- TLS/SRTP、WSS；证书轮换
- 权限/RBAC：最小权限、字段脱敏校验
- 外呼时间窗、双录提示策略
- 审计日志完整性

## 3. 工具与数据
- SIPp：183/480/486/404 混合场景，抖动/丢包
- 语料包：多运营商关机/停机/空号/不在服务区/忙/彩铃/信箱
- Locust/k6：API/WS 压测；Kafka/NATS 背压

## 4. 验收标准
- 准确率：ASR 综合 ≥ 97%，强规则 ≥ 99%
- 延迟：早期媒体判定 ≤ 1.5s；API P99 ≤ 200ms（内网）
- 稳定：峰值期间无错误放大；录音丢失率 < 0.01%
- 合规：审计与时间窗/双录提示全通过

## 5. 回归与灰度
- 影子模式与 A/B：仅观察不挂断 → 误判率稳定后切换强制
- 回滚：禁用 audio_fork 与 ASR Gateway，即时回落信令策略